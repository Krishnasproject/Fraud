{% extends "base.html" %}
{% block title %}Fraud Detection - Predict{% endblock %}
{% block extra_css %}
<style>
    .container {
        max-width: 700px;
    }
    #result {
        margin-top: 30px;
        padding: 20px;
        border-radius: 8px;
        display: none;
        border-left: 4px solid;
    }
    #result.fraud {
        background-color: #f8d7da;
        border-color: #dc3545;
        color: #721c24;
    }
    #result.safe {
        background-color: #d4edda;
        border-color: #28a745;
        color: #155724;
    }
    #result h3 {
        margin-bottom: 15px;
        font-size: 1.25rem;
    }
    #result ul {
        margin-left: 20px;
        margin-top: 10px;
    }
    .loading {
        text-align: center;
        color: #007bff;
        display: none;
        font-weight: 500;
    }
</style>
{% endblock %}
{% block content %}
<div class="container">
    <nav>
        <div>
            <a href="{{ url_for('predict') }}">Predict</a>
            <a href="{{ url_for('profile') }}">Profile</a>
        </div>
        <div>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </nav>
    <h1>Fraud Detection Prediction</h1>
    <form id="predictForm">
        <div class="form-group">
            <label for="AccountID">Account ID</label>
            <input type="number" id="AccountID" name="AccountID" required>
        </div>
        <div class="form-group">
            <label for="TransactionAmount">Transaction Amount</label>
            <input type="number" id="TransactionAmount" name="TransactionAmount" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="AccountBalance">Account Balance</label>
            <input type="number" id="AccountBalance" name="AccountBalance" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="TransactionType">Transaction Type</label>
            <select id="TransactionType" name="TransactionType" required>
                <option value="">Select Type</option>
                <option value="Transfer">Transfer</option>
                <option value="Withdrawal">Withdrawal</option>
                <option value="Deposit">Deposit</option>
            </select>
        </div>
        <div class="form-group">
            <label for="HourOfTransaction">Hour of Transaction (0-23)</label>
            <input type="number" id="HourOfTransaction" name="HourOfTransaction" min="0" max="23" required>
        </div>
        <div class="form-group">
            <label for="Longitude">Longitude</label>
            <input type="number" id="Longitude" name="Longitude" step="0.000001" required>
        </div>
        <div class="form-group">
            <label for="Latitude">Latitude</label>
            <input type="number" id="Latitude" name="Latitude" step="0.000001" required>
        </div>
        <button type="submit">Check for Fraud</button>
    </form>
    <div class="loading" id="loading">Processing...</div>
    <div id="result"></div>
</div>
<script>
    document.getElementById('predictForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const data = {};
        for (let [key, value] of formData.entries()) {
            if (key === 'AccountID' || key === 'HourOfTransaction') {
                data[key] = parseInt(value);
            } else if (key === 'TransactionAmount' || key === 'AccountBalance' || key === 'Longitude' || key === 'Latitude') {
                data[key] = parseFloat(value);
            } else {
                data[key] = value;
            }
        }
        
        const resultDiv = document.getElementById('result');
        const loadingDiv = document.getElementById('loading');
        resultDiv.style.display = 'none';
        loadingDiv.style.display = 'block';
        
        try {
            const response = await fetch('{{ url_for("predict") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            loadingDiv.style.display = 'none';
            
            if (response.ok) {
                resultDiv.className = result.Fraudulent === 'Yes' ? 'fraud' : 'safe';
                resultDiv.innerHTML = `
                    <h3>Prediction Result: ${result.Fraudulent === 'Yes' ? '⚠️ FRAUDULENT' : '✓ SAFE'}</h3>
                    <p><strong>Anomaly Score:</strong> ${result.AnomalyScore}</p>
                    <h4>Reasons:</h4>
                    <ul>
                        ${result.Reasons.map(reason => `<li>${reason}</li>`).join('')}
                    </ul>
                `;
                resultDiv.style.display = 'block';
            } else {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `<h3>Error</h3><p>${result.error || 'An error occurred'}</p>`;
                resultDiv.style.display = 'block';
            }
        } catch (error) {
            loadingDiv.style.display = 'none';
            resultDiv.className = 'error';
            resultDiv.innerHTML = `<h3>Error</h3><p>${error.message}</p>`;
            resultDiv.style.display = 'block';
        }
    });
</script>
{% endblock %}

